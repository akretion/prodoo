"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,context:{lang:"fr_FR"},shouldManageSessionId:!1,errorInterceptors:[]};var e=null;this.$get=["$http","$q","$timeout",function(n,o,s){var r=this.odooRpc;return r.login=function(e,n,s){var i={db:e,login:n,password:s};return r.sendRequest("/web/session/authenticate",i).then(function(e){return e.uid?(r.context=e.user_context,t.set_sessionId(e.session_id),e):(t.delete_sessionId(),o.reject({title:"wrong_login",message:"Username and password don't match",fullTrace:e}))})},r.isLoggedIn=function(e){return e?r.getSessionInfo().then(function(e){return t.set_sessionId(e.session_id),!!e.uid}):t.get_sessionId().length>0},r.logout=function(e){return t.delete_sessionId(),e?r.getSessionInfo().then(function(e){return e.db?r.login(e.db,"",""):void 0}):o.when()},r.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return r.sendRequest("/web/dataset/search_read",o)},r.getSessionInfo=function(){return r.sendRequest("/web/session/get_session_info",{})},r.getServerInfo=function(){return r.sendRequest("/web/webclient/version_info",{})},r.getDbList=function(){return r.sendRequest("/web/database/get_list",{})},r.syncDataImport=function(e,t,n,o,s,i){return r.call(e,"get_sync_data",[t,i.timekey,n,o,s],{}).then(function(a){return i.timekey=a.timekey,angular.forEach(a.remove_ids,function(e){delete i.data[e]}),Object.keys(a.data).length?(angular.merge(i.data,a.data),r.syncDataImport(e,t,n,o,s,i)):void 0})},r.syncImportObject=function(e){function t(t){i||s(o,t||e.interval)}function n(){a.forEach(function(e){e(u)})}function o(){r.syncDataImport(e.model,e.func_key,e.base_domain,e.filter_domain,e.limit,u).then(t).then(n).catch(c)}var i=!1,a=[],u={data:{},timekey:null,stopCallback:function(){i=!0},watch:function(e){a.push(e)},nextSync:t},c=null;return angular.isFunction(e.onErrorRetry)?c=function(t){e.onErrorRetry(u,t)}:e.onErrorRetry&&(c=function(){t()}),o(),u},r.call=function(e,t,n,o){o=o||{},o.context=o.context||{},angular.extend(o.context,r.context);var s={model:e,method:t,args:n,kwargs:o};return r.sendRequest("/web/dataset/call_kw",s)},r.sendRequest=function(s,i){function a(e,n){r.uniq_id_counter+=1,r.shouldManageSessionId&&(n.session_id=t.get_sessionId());var o={jsonrpc:"2.0",method:"call",params:n},s={"Content-Type":"application/json","X-Openerp-Session-Id":t.get_sessionId()};return{method:"POST",url:r.odoo_server+e,data:JSON.stringify(o),headers:s,id:"r"+r.uniq_id_counter}}function u(e){if(!e.data.error)return e.data;var n=e.data.error,s={title:"",message:"",fullTrace:n};if(200===n.code&&"Odoo Server Error"===n.message&&"werkzeug.exceptions.NotFound"===n.data.name)s.title="page_not_found",s.message="HTTP Error";else if(100===n.code&&"Odoo Session Expired"===n.message||300===n.code&&"OpenERP WebClient Error"===n.message&&n.data.debug.match("SessionExpiredException"))s.title="session_expired",t.delete_sessionId();else if("Odoo Server Error"===n.message&&/FATAL:  database "(.+)" does not exist/.test(n.data.message))s.title="database_not_found",s.message=n.data.message;else if("openerp.exceptions.AccessError"===n.data.name)s.title="AccessError",s.message=n.data.message;else{var i=(""+n.data.fault_code).split("\n")[0].split(" -- ");i.length>1&&(n.type=i.shift(),n.data.fault_code=n.data.fault_code.substr(n.type.length+4)),200===n.code&&n.type?(s.title=n.type,s.message=n.data.fault_code.replace(/\n/g,"<br />")):(s.title=n.message,s.message=n.data.debug.replace(/\n/g,"<br />"))}return r.errorInterceptors.forEach(function(e){e(s)}),o.reject(s)}function c(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};return r.errorInterceptors.forEach(function(e){e(t)}),o.reject(t)}function d(e,t){var o=a(e,t);return n(o).then(u,c)}function l(){return e||d("/web/webclient/version_info",{}).then(function(t){r.shouldManageSessionId=t.result.server_serie<"8",e=o.when()})}return l().then(function(){return d(s,i).then(function(e){var t=[];return"ir.actions.act_proxy"===e.result.type?(angular.forEach(e.result.action_list,function(e){t.push(n.post(e.url,e.params))}),o.all(t)):e.result})})},r}];var t=function(){var e;return{delete_sessionId:function(){e=null,document.cookie="session_id=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},get_sessionId:function(){return document.cookie.split("; ").filter(function(e){return 0===e.indexOf("session_id")}).map(function(e){return e.split("=")[1]}).pop()||e||""},set_sessionId:function(t){document.cookie="session_id="+t,e=t}}}()});